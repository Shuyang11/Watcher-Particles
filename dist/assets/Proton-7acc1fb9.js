import{c as ae,g as se}from"./_commonjsHelpers-de833af9.js";import{s as oe}from"./index-fa3b3039.js";import{R as he,r as le,z as ue,k as ce,A as Tt,o as Pt,c as wt,J as de,a as Rt}from"./vendor-20d2a5d6.js";function _t(x){x=x||{},x.statusInterval==null&&(x.statusInterval=5e3),x.loggingDelay==null&&(x.loggingDelay=20*1e3),x.noProgressTimeout==null&&(x.noProgressTimeout=1/0);var E=[],_=[],c,I=+new Date,v={QUEUED:0,WAITING:1,LOADED:2,ERROR:3,TIMEOUT:4},D=function(d){return d==null?[]:Array.isArray(d)?d:[d]};this.add=function(d){d.tags=new dt(d.tags),d.priority==null&&(d.priority=1/0),E.push({resource:d,status:v.QUEUED})},this.addProgressListener=function(d,A){_.push({callback:d,tags:new dt(A)})},this.addCompletionListener=function(d,A){_.push({tags:new dt(A),callback:function(f){f.completedCount===f.totalCount&&d()}})};var O=function(d){d=D(d);var A=function(f){for(var g=f.resource,y=1/0,T=0;T<g.tags.length;T++)for(var u=0;u<Math.min(d.length,y)&&!(g.tags[T]==d[u]&&u<y&&(y=u,y===0)||y===0);u++);return y};return function(f,g){var y=A(f),T=A(g);return y<T?-1:y>T?1:f.priority<g.priority?-1:f.priority>g.priority?1:0}};this.start=function(d){c=+new Date;var A=O(d);E.sort(A);for(var f=0,g=E.length;f<g;f++){var y=E[f];y.status=v.WAITING,y.resource.start(this)}setTimeout(P,100)};var P=function(){for(var d=!1,A=+new Date-I,f=A>=x.noProgressTimeout,g=A>=x.loggingDelay,y=0,T=E.length;y<T;y++){var u=E[y];u.status===v.WAITING&&(u.resource.checkStatus&&u.resource.checkStatus(),u.status===v.WAITING&&(f?u.resource.onTimeout():d=!0))}g&&d&&B(),d&&setTimeout(P,x.statusInterval)};this.isBusy=function(){for(var d=0,A=E.length;d<A;d++)if(E[d].status===v.QUEUED||E[d].status===v.WAITING)return!0;return!1};var M=function(d,A){for(var f=null,g=0,y=E.length;g<y;g++)if(E[g].resource===d){f=E[g];break}if(!(f==null||f.status!==v.WAITING)){f.status=A,I=+new Date,d.tags.length;for(var g=0,T=_.length;g<T;g++){var u=_[g],L;u.tags.length===0?L=!0:L=d.tags.contains(u.tags),L&&V(f,u)}}};this.onLoad=function(d){M(d,v.LOADED)},this.onError=function(d){M(d,v.ERROR)},this.onTimeout=function(d){M(d,v.TIMEOUT)};var V=function(d,A){for(var f=0,g=0,y=0,T=E.length;y<T;y++){var u=E[y],L=!1;A.tags.length===0?L=!0:L=u.resource.tags.contains(A.tags),L&&(g++,(u.status===v.LOADED||u.status===v.ERROR||u.status===v.TIMEOUT)&&f++)}A.callback({resource:d.resource,loaded:d.status===v.LOADED,error:d.status===v.ERROR,timeout:d.status===v.TIMEOUT,completedCount:f,totalCount:g})},B=this.log=function(d){if(window.console){var A=Math.round((+new Date-c)/1e3);window.console.log("PxLoader elapsed: "+A+" sec");for(var f=0,g=E.length;f<g;f++){var y=E[f];if(!(!d&&y.status!==v.WAITING)){var T="PxLoader: #"+f+" "+y.resource.getName();switch(y.status){case v.QUEUED:T+=" (Not Started)";break;case v.WAITING:T+=" (Waiting)";break;case v.LOADED:T+=" (Loaded)";break;case v.ERROR:T+=" (Error)";break;case v.TIMEOUT:T+=" (Timeout)";break}y.resource.tags.length>0&&(T+=" Tags: ["+y.resource.tags.join(",")+"]"),window.console.log(T)}}}}}function pe(x,E,_){var c=this,I=null;this.img=new Image,this.tags=E,this.priority=_;var v=function(){c.img.readyState=="complete"&&(P(),I.onLoad(c))},D=function(){P(),I.onLoad(c)},O=function(){P(),I.onError(c)},P=function(){c.unbind("load",D),c.unbind("readystatechange",v),c.unbind("error",O)};this.start=function(M){I=M,c.bind("load",D),c.bind("readystatechange",v),c.bind("error",O),c.img.src=x},this.checkStatus=function(){c.img.complete&&(P(),I.onLoad(c))},this.onTimeout=function(){P(),c.img.complete?I.onLoad(c):I.onTimeout(c)},this.getName=function(){return x},this.bind=function(M,V){c.img.addEventListener?c.img.addEventListener(M,V,!1):c.img.attachEvent&&c.img.attachEvent("on"+M,V)},this.unbind=function(M,V){c.img.removeEventListener?c.img.removeEventListener(M,V,!1):c.img.detachEvent&&c.img.detachEvent("on"+M,V)}}function dt(x){if(this.array=[],this.object={},this.value=null,this.length=0,x!=null){if(Array.isArray(x))this.array=x;else if(typeof x=="object")for(var E in x)this.array.push(E);else this.array.push(x),this.value=x;this.length=this.array.length;for(var _=0;_<this.length;_++)this.object[this.array[_]]=!0}this.contains=function(c){if(this.length===0||c.length===0)return!1;if(this.length===1&&this.value!==null)return c.length===1?this.value===c.value:c.object.hasOwnProperty(this.value);if(c.length<this.length)return c.contains(this);for(var I in this.object)if(c.object[I])return!0;return!1}}_t.prototype.addImage=function(x,E,_){var c=new pe(x,E,_);return this.add(c),c.img},Array.isArray||(Array.isArray=function(x){return Object.prototype.toString.call(x)=="[object Array]"});var It={exports:{}};/*!
* Proton v6.0.3
* https://github.com/drawcall/Proton
*
* Copyright 2013-2023, drawcall
* Licensed under the MIT license
* http://www.opensource.org/licenses/mit-license
*
*/(function(x,E){(function(_,c){x.exports=c()})(ae,function(){function _(r,n){for(var e=0;e<n.length;e++){var t=n[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(r,t.key,t)}}function c(r,n){r.prototype=Object.create(n.prototype),r.prototype.constructor=r,I(r,n)}function I(r,n){return I=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},I(r,n)}function v(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}var D=function(r){--r;for(var n=1;n<32;n<<=1)r|=r>>n;return r+1},O=function(r,n){return[1,0,0,0,1,0,r,n,1]},P=function(r){var n=Math.cos(r),e=Math.sin(r);return[n,-e,0,e,n,0,0,0,1]},M=function(r,n){return[r,0,0,0,n,0,0,0,1]},V=function(r,n){var e=r[0],t=r[1],i=r[2],a=r[3],s=r[4],o=r[5],h=r[6],C=r[7],R=r[8],k=n[0],N=n[1],W=n[2],H=n[3],K=n[4],J=n[5],lt=n[6],ut=n[7],ct=n[8];return[e*k+t*H+i*lt,e*N+t*K+i*ut,e*W+t*J+i*ct,a*k+s*H+o*lt,a*N+s*K+o*ut,a*W+s*J+o*ct,h*k+C*H+R*lt,h*N+C*K+R*ut,h*W+C*J+R*ct]},B={createCanvas:function(r,n,e,t){t===void 0&&(t="absolute");var i=document.createElement("canvas");return i.id=r,i.width=n,i.height=e,i.style.opacity=0,i.style.position=t,this.transform(i,-500,-500,0,0),i},createDiv:function(r,n,e){var t=document.createElement("div");return t.id=r,t.style.position="absolute",this.resize(t,n,e),t},resize:function(r,n,e){r.style.width=n+"px",r.style.height=e+"px",r.style.marginLeft=-n/2+"px",r.style.marginTop=-e/2+"px"},transform:function(r,n,e,t,i){r.style.willChange="transform";var a="translate("+n+"px, "+e+"px) scale("+t+") rotate("+i+"deg)";this.css3(r,"transform",a)},transform3d:function(r,n,e,t,i){r.style.willChange="transform";var a="translate3d("+n+"px, "+e+"px, 0) scale("+t+") rotate("+i+"deg)";this.css3(r,"backfaceVisibility","hidden"),this.css3(r,"transform",a)},css3:function(r,n,e){var t=n.charAt(0).toUpperCase()+n.substr(1);r.style["Webkit"+t]=e,r.style["Moz"+t]=e,r.style["O"+t]=e,r.style["ms"+t]=e,r.style[""+n]=e}},d={},A={},f=0,g=function(r,n,e){r.drawImage(n,e.x,e.y);var t=r.getImageData(e.x,e.y,e.width,e.height);return r.clearRect(e.x,e.y,e.width,e.height),t},y=function(r,n,e){var t=typeof r=="string"?r:r.src;if(d[t])n(d[t],e);else{var i=new Image;i.onload=function(a){d[t]=a.target,n(d[t],e)},i.src=t}},T=function(r,n,e){var t=r.src;if(!A[t]){var i=D(r.width),a=D(r.height),s=B.createCanvas("proton_canvas_cache_"+ ++f,i,a);s.getContext("2d").drawImage(r,0,0,r.width,r.height),A[t]=s}return n&&n(A[t],e),A[t]},u={initValue:function(r,n){return r=r??n},isArray:function(r){return Object.prototype.toString.call(r)==="[object Array]"},emptyArray:function(r){r&&(r.length=0)},toArray:function(r){return this.isArray(r)?r:[r]},sliceArray:function(r,n,e){this.emptyArray(e);for(var t=n;t<r.length;t++)e.push(r[t])},getRandFromArray:function(r){return r?r[Math.floor(r.length*Math.random())]:null},emptyObject:function(r,n){for(var e in n===void 0&&(n=null),r)n&&n.indexOf(e)>-1||delete r[e]},classApply:function(r,n){return n===void 0&&(n=null),n?new(r.bind.apply(r,[null].concat(n))):new r},getImageData:function(r,n,e){return g(r,n,e)},destroyAll:function(r,n){n===void 0&&(n=null);for(var e=r.length;e--;){try{r[e].destroy(n)}catch{}delete r[e]}r.length=0},assign:function(r,n){if(typeof Object.assign!="function"){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(r[e]=n[e]);return r}return Object.assign(r,n)}},L={},$={_index:0,_cache:{},id:function(r){return L[r]!==void 0&&L[r]!==null||(L[r]=0),r+"_"+L[r]++},getId:function(r){var n=this.getIdFromCache(r);return n||(n="PUID_"+this._index++,this._cache[n]=r,n)},getIdFromCache:function(r){var n,e;for(e in this._cache)if((n=this._cache[e])===r||this.isBody(n,r)&&n.src===r.src)return e;return null},isBody:function(r,n){return typeof r=="object"&&typeof n=="object"&&r.isInner&&n.isInner},getTarget:function(r){return this._cache[r]}},tt=function(){function r(e){this.total=0,this.cache={}}var n=r.prototype;return n.get=function(e,t,i){var a;return i=i||e.__puid||$.getId(e),(a=this.cache[i]&&this.cache[i].length>0?this.cache[i].pop():this.createOrClone(e,t)).__puid=e.__puid||i,a},n.expire=function(e){return this.getCache(e.__puid).push(e)},n.createOrClone=function(e,t){return this.total++,this.create?this.create(e,t):typeof e=="function"?u.classApply(e,t):e.clone()},n.getCount=function(){var e=0;for(var t in this.cache)e+=this.cache[t].length;return e++},n.destroy=function(){for(var e in this.cache)this.cache[e].length=0,delete this.cache[e]},n.getCache=function(e){return e===void 0&&(e="default"),this.cache[e]||(this.cache[e]=[]),this.cache[e]},r}(),st=function(){function r(e){this.proton=e,this.container=null,this.type=1,this.emitterIndex=0,this.rendererIndex=0}var n=r.prototype;return n.update=function(e,t){this.add(e,t);var i=this.getEmitter(),a=this.getRenderer(),s="";switch(this.type){case 2:s+="emitter:"+this.proton.emitters.length+"<br>",i&&(s+="em speed:"+i.emitSpeed+"<br>"),i&&(s+="pos:"+this.getEmitterPos(i));break;case 3:i&&(s+="initializes:"+i.initializes.length+"<br>"),i&&(s+='<span style="display:inline-block;">'+this.concatArr(i.initializes)+"</span><br>"),i&&(s+="behaviours:"+i.behaviours.length+"<br>"),i&&(s+='<span style="display:inline-block;">'+this.concatArr(i.behaviours)+"</span><br>");break;case 4:a&&(s+=a.name+"<br>"),a&&(s+="body:"+this.getCreatedNumber(a)+"<br>");break;default:s+="particles:"+this.proton.getCount()+"<br>",s+="pool:"+this.proton.pool.getCount()+"<br>",s+="total:"+this.proton.pool.total}this.container.innerHTML=s},n.add=function(e,t){var i=this;if(!this.container){var a,s;switch(this.type=1,this.container=document.createElement("div"),this.container.style.cssText=["position:absolute;bottom:0px;left:0;cursor:pointer;","opacity:0.9;z-index:10000;padding:10px;font-size:12px;font-family:Helvetica,Arial,sans-serif;","width:120px;height:50px;background-color:#002;color:#0ff;"].join(""),this.container.addEventListener("click",function(o){i.type++,i.type>4&&(i.type=1)},!1),e){case 2:a="#201",s="#f08";break;case 3:a="#020",s="#0f0";break;default:a="#002",s="#0ff"}this.container.style["background-color"]=a,this.container.style.color=s}this.container.parentNode||(t=t||this.body||document.body).appendChild(this.container)},n.getEmitter=function(){return this.proton.emitters[this.emitterIndex]},n.getRenderer=function(){return this.proton.renderers[this.rendererIndex]},n.concatArr=function(e){var t="";if(!e||!e.length)return t;for(var i=0;i<e.length;i++)t+=(e[i].name||"").substr(0,1)+".";return t},n.getCreatedNumber=function(e){return e.pool.total||e.cpool&&e.cpool.total||0},n.getEmitterPos=function(e){return Math.round(e.p.x)+","+Math.round(e.p.y)},n.destroy=function(){this.container&&this.container.parentNode&&(this.body||document.body).removeChild(this.container),this.proton=null,this.container=null},r}(),rt=function(){function r(){this._listeners=null}r.bind=function(e){e.prototype.dispatchEvent=r.prototype.dispatchEvent,e.prototype.hasEventListener=r.prototype.hasEventListener,e.prototype.addEventListener=r.prototype.addEventListener,e.prototype.removeEventListener=r.prototype.removeEventListener,e.prototype.removeAllEventListeners=r.prototype.removeAllEventListeners};var n=r.prototype;return n.addEventListener=function(e,t){return this._listeners?this.removeEventListener(e,t):this._listeners={},this._listeners[e]||(this._listeners[e]=[]),this._listeners[e].push(t),t},n.removeEventListener=function(e,t){if(this._listeners&&this._listeners[e]){for(var i=this._listeners[e],a=i.length,s=0;s<a;s++)if(i[s]===t){a===1?delete this._listeners[e]:i.splice(s,1);break}}},n.removeAllEventListeners=function(e){e?this._listeners&&delete this._listeners[e]:this._listeners=null},n.dispatchEvent=function(e,t){var i=!1,a=this._listeners;if(e&&a){var s,o=a[e];if(!o)return i;for(var h=o.length;h--;)s=o[h],i=i||s(t)}return!!i},n.hasEventListener=function(e){var t=this._listeners;return!(!t||!t[e])},r}(),G=3.1415926,b={PI:G,PIx2:2*G,PI_2:G/2,PI_180:G/180,N180_PI:180/G,Infinity:-999,isInfinity:function(r){return r===this.Infinity||r===1/0},randomAToB:function(r,n,e){return e===void 0&&(e=!1),e?(Math.random()*(n-r)>>0)+r:r+Math.random()*(n-r)},randomFloating:function(r,n,e){return this.randomAToB(r-n,r+n,e)},randomColor:function(){return"#"+("00000"+(16777216*Math.random()<<0).toString(16)).slice(-6)},randomZone:function(r){},floor:function(r,n){n===void 0&&(n=4);var e=Math.pow(10,n);return Math.floor(r*e)/e},degreeTransform:function(r){return r*G/180},toColor16:function(r){return"#"+r.toString(16)}},U=function(){function r(e){this.type=e}var n=r.prototype;return n.calculate=function(e,t,i){this.eulerIntegrate(e,t,i)},n.eulerIntegrate=function(e,t,i){e.sleep||(e.old.p.copy(e.p),e.old.v.copy(e.v),e.a.multiplyScalar(1/e.mass),e.v.add(e.a.multiplyScalar(t)),e.p.add(e.old.v.multiplyScalar(t)),i&&e.v.multiplyScalar(i),e.a.clear())},r}(),l=function(){function r(i){this.emitters=[],this.renderers=[],this.time=0,this.now=0,this.then=0,this.elapsed=0,this.stats=new st(this),this.pool=new tt(80),this.integrationType=u.initValue(i,r.EULER),this.integrator=new U(this.integrationType),this._fps="auto",this._interval=r.DEFAULT_INTERVAL}var n,e,t=r.prototype;return t.addRenderer=function(i){i.init(this),this.renderers.push(i)},t.removeRenderer=function(i){var a=this.renderers.indexOf(i);this.renderers.splice(a,1),i.remove(this)},t.addEmitter=function(i){this.emitters.push(i),i.parent=this,this.dispatchEvent(r.EMITTER_ADDED,i)},t.removeEmitter=function(i){var a=this.emitters.indexOf(i);this.emitters.splice(a,1),i.parent=null,this.dispatchEvent(r.EMITTER_REMOVED,i)},t.update=function(){this._fps==="auto"?(this.dispatchEvent(r.PROTON_UPDATE),r.USE_CLOCK?(this.then||(this.then=new Date().getTime()),this.now=new Date().getTime(),this.elapsed=.001*(this.now-this.then),this.amendChangeTabsBug(),this.elapsed>0&&this.emittersUpdate(this.elapsed),this.then=this.now):this.emittersUpdate(r.DEFAULT_INTERVAL),this.dispatchEvent(r.PROTON_UPDATE_AFTER)):(this.then||(this.then=new Date().getTime()),this.now=new Date().getTime(),this.elapsed=.001*(this.now-this.then),this.elapsed>this._interval&&(this.dispatchEvent(r.PROTON_UPDATE),this.emittersUpdate(this._interval),this.then=this.now-this.elapsed%this._interval*1e3,this.dispatchEvent(r.PROTON_UPDATE_AFTER)))},t.emittersUpdate=function(i){for(var a=this.emitters.length;a--;)this.emitters[a].update(i)},t.amendChangeTabsBug=function(){r.amendChangeTabsBug&&this.elapsed>.5&&(this.then=new Date().getTime(),this.elapsed=0)},t.getCount=function(){for(var i=0,a=this.emitters.length;a--;)i+=this.emitters[a].particles.length;return i},t.getAllParticles=function(){for(var i=[],a=this.emitters.length;a--;)i=i.concat(this.emitters[a].particles);return i},t.destroyAllEmitters=function(){u.destroyAll(this.emitters)},t.destroy=function(i){var a=this;i===void 0&&(i=!1);var s=function(){a.time=0,a.then=0,a.pool.destroy(),a.stats.destroy(),u.destroyAll(a.emitters),u.destroyAll(a.renderers,a.getAllParticles()),a.integrator=null,a.renderers=null,a.emitters=null,a.stats=null,a.pool=null};i?setTimeout(s,200):s()},n=r,(e=[{key:"fps",get:function(){return this._fps},set:function(i){this._fps=i,this._interval=i==="auto"?r.DEFAULT_INTERVAL:b.floor(1/i,7)}}])&&_(n.prototype,e),r}();l.USE_CLOCK=!1,l.MEASURE=100,l.EULER="euler",l.RK2="runge-kutta2",l.PARTICLE_CREATED="PARTICLE_CREATED",l.PARTICLE_UPDATE="PARTICLE_UPDATE",l.PARTICLE_SLEEP="PARTICLE_SLEEP",l.PARTICLE_DEAD="PARTICLE_DEAD",l.EMITTER_ADDED="EMITTER_ADDED",l.EMITTER_REMOVED="EMITTER_REMOVED",l.PROTON_UPDATE="PROTON_UPDATE",l.PROTON_UPDATE_AFTER="PROTON_UPDATE_AFTER",l.DEFAULT_INTERVAL=.0167,l.amendChangeTabsBug=!0,rt.bind(l);var p=function(){function r(n,e,t){n===void 0&&(n=255),e===void 0&&(e=255),t===void 0&&(t=255),this.r=n,this.g=e,this.b=t}return r.prototype.reset=function(){this.r=255,this.g=255,this.b=255},r}(),m=function(){function r(n,e,t){u.isArray(n)?(this.isArray=!0,this.a=n):(this.isArray=!1,this.a=u.initValue(n,1),this.b=u.initValue(e,this.a),this.center=u.initValue(t,!1))}return r.prototype.getValue=function(n){return n===void 0&&(n=!1),this.isArray?u.getRandFromArray(this.a):this.center?b.randomFloating(this.a,this.b,n):b.randomAToB(this.a,this.b,n)},r.setSpanValue=function(n,e,t){return n instanceof r?n:e===void 0?new r(n):t===void 0?new r(n,e):new r(n,e,t)},r.getSpanValue=function(n){return n instanceof r?n.getValue():n},r}(),et={hasProp:function(r,n){return!!r&&r[n]!==void 0},setProp:function(r,n){for(var e in n)r.hasOwnProperty(e)&&(r[e]=m.getSpanValue(n[e]));return r},setVectorVal:function(r,n){n===void 0&&(n=null),n&&(this.hasProp(n,"x")&&(r.p.x=n.x),this.hasProp(n,"y")&&(r.p.y=n.y),this.hasProp(n,"vx")&&(r.v.x=n.vx),this.hasProp(n,"vy")&&(r.v.y=n.vy),this.hasProp(n,"ax")&&(r.a.x=n.ax),this.hasProp(n,"ay")&&(r.a.y=n.ay),this.hasProp(n,"p")&&r.p.copy(n.p),this.hasProp(n,"v")&&r.v.copy(n.v),this.hasProp(n,"a")&&r.a.copy(n.a),this.hasProp(n,"position")&&r.p.copy(n.position),this.hasProp(n,"velocity")&&r.v.copy(n.velocity),this.hasProp(n,"accelerate")&&r.a.copy(n.accelerate))}},j={easeLinear:function(r){return r},easeInQuad:function(r){return Math.pow(r,2)},easeOutQuad:function(r){return-(Math.pow(r-1,2)-1)},easeInOutQuad:function(r){return(r/=.5)<1?.5*Math.pow(r,2):-.5*((r-=2)*r-2)},easeInCubic:function(r){return Math.pow(r,3)},easeOutCubic:function(r){return Math.pow(r-1,3)+1},easeInOutCubic:function(r){return(r/=.5)<1?.5*Math.pow(r,3):.5*(Math.pow(r-2,3)+2)},easeInQuart:function(r){return Math.pow(r,4)},easeOutQuart:function(r){return-(Math.pow(r-1,4)-1)},easeInOutQuart:function(r){return(r/=.5)<1?.5*Math.pow(r,4):-.5*((r-=2)*Math.pow(r,3)-2)},easeInSine:function(r){return 1-Math.cos(r*b.PI_2)},easeOutSine:function(r){return Math.sin(r*b.PI_2)},easeInOutSine:function(r){return-.5*(Math.cos(Math.PI*r)-1)},easeInExpo:function(r){return r===0?0:Math.pow(2,10*(r-1))},easeOutExpo:function(r){return r===1?1:1-Math.pow(2,-10*r)},easeInOutExpo:function(r){return r===0?0:r===1?1:(r/=.5)<1?.5*Math.pow(2,10*(r-1)):.5*(2-Math.pow(2,-10*--r))},easeInCirc:function(r){return-(Math.sqrt(1-r*r)-1)},easeOutCirc:function(r){return Math.sqrt(1-Math.pow(r-1,2))},easeInOutCirc:function(r){return(r/=.5)<1?-.5*(Math.sqrt(1-r*r)-1):.5*(Math.sqrt(1-(r-=2)*r)+1)},easeInBack:function(r){var n=1.70158;return r*r*((n+1)*r-n)},easeOutBack:function(r){var n=1.70158;return(r-=1)*r*((n+1)*r+n)+1},easeInOutBack:function(r){var n=1.70158;return(r/=.5)<1?r*r*((1+(n*=1.525))*r-n)*.5:.5*((r-=2)*r*((1+(n*=1.525))*r+n)+2)},getEasing:function(r){return typeof r=="function"?r:this[r]||this.easeLinear}},w=function(){function r(e,t){this.x=e||0,this.y=t||0}var n=r.prototype;return n.set=function(e,t){return this.x=e,this.y=t,this},n.setX=function(e){return this.x=e,this},n.setY=function(e){return this.y=e,this},n.getGradient=function(){return this.x!==0?Math.atan2(this.y,this.x):this.y>0?b.PI_2:this.y<0?-b.PI_2:void 0},n.copy=function(e){return this.x=e.x,this.y=e.y,this},n.add=function(e,t){return t!==void 0?this.addVectors(e,t):(this.x+=e.x,this.y+=e.y,this)},n.addXY=function(e,t){return this.x+=e,this.y+=t,this},n.addVectors=function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},n.sub=function(e,t){return t!==void 0?this.subVectors(e,t):(this.x-=e.x,this.y-=e.y,this)},n.subVectors=function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},n.divideScalar=function(e){return e!==0?(this.x/=e,this.y/=e):this.set(0,0),this},n.multiplyScalar=function(e){return this.x*=e,this.y*=e,this},n.negate=function(){return this.multiplyScalar(-1)},n.dot=function(e){return this.x*e.x+this.y*e.y},n.lengthSq=function(){return this.x*this.x+this.y*this.y},n.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},n.normalize=function(){return this.divideScalar(this.length())},n.distanceTo=function(e){return Math.sqrt(this.distanceToSquared(e))},n.rotate=function(e){var t=this.x,i=this.y;return this.x=t*Math.cos(e)+i*Math.sin(e),this.y=-t*Math.sin(e)+i*Math.cos(e),this},n.distanceToSquared=function(e){var t=this.x-e.x,i=this.y-e.y;return t*t+i*i},n.lerp=function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},n.equals=function(e){return e.x===this.x&&e.y===this.y},n.clear=function(){return this.x=0,this.y=0,this},n.clone=function(){return new r(this.x,this.y)},r}(),ot=function(){function r(e){this.id="",this.old=null,this.data=null,this.behaviours=null,this.p=null,this.v=null,this.a=null,this.rgb=null,this.name="Particle",this.id=$.id(this.name),this.old={},this.data={},this.behaviours=[],this.p=new w,this.v=new w,this.a=new w,this.old.p=new w,this.old.v=new w,this.old.a=new w,this.rgb=new p,this.reset(),e&&et.setProp(this,e)}var n=r.prototype;return n.getDirection=function(){return Math.atan2(this.v.x,-this.v.y)*b.N180_PI},n.reset=function(){return this.life=1/0,this.age=0,this.dead=!1,this.sleep=!1,this.body=null,this.sprite=null,this.parent=null,this.energy=1,this.mass=1,this.radius=10,this.alpha=1,this.scale=1,this.rotation=0,this.color=null,this.p.set(0,0),this.v.set(0,0),this.a.set(0,0),this.old.p.set(0,0),this.old.v.set(0,0),this.old.a.set(0,0),this.easing=j.easeLinear,this.rgb.reset(),u.emptyObject(this.data),this.removeAllBehaviours(),this},n.update=function(e,t){if(this.sleep||(this.age+=e,this.applyBehaviours(e,t)),this.age<this.life){var i=this.easing(this.age/this.life);this.energy=Math.max(1-i,0)}else this.destroy()},n.applyBehaviours=function(e,t){var i,a=this.behaviours.length;for(i=0;i<a;i++)this.behaviours[i]&&this.behaviours[i].applyBehaviour(this,e,t)},n.addBehaviour=function(e){this.behaviours.push(e),e.hasOwnProperty("parents")&&e.parents.push(this),e.initialize(this)},n.addBehaviours=function(e){var t,i=e.length;for(t=0;t<i;t++)this.addBehaviour(e[t])},n.removeBehaviour=function(e){var t=this.behaviours.indexOf(e);t>-1&&(this.behaviours.splice(t,1).parents=null)},n.removeAllBehaviours=function(){u.emptyArray(this.behaviours)},n.destroy=function(){this.removeAllBehaviours(),this.energy=0,this.dead=!0,this.parent=null},r}(),Y={hexToRgb:function(r){var n=r.charAt(0)==="#"?r.substring(1,7):r;return{r:parseInt(n.substring(0,2),16),g:parseInt(n.substring(2,4),16),b:parseInt(n.substring(4,6),16)}},rgbToHex:function(r){return"rgb("+r.r+", "+r.g+", "+r.b+")"},getHex16FromParticle:function(r){return 65536*Number(r.rgb.r)+256*Number(r.rgb.g)+Number(r.rgb.b)}},pt=function(){function r(e,t){this.r=Math.abs(e)||0,this.tha=t||0}var n=r.prototype;return n.set=function(e,t){return this.r=e,this.tha=t,this},n.setR=function(e){return this.r=e,this},n.setTha=function(e){return this.tha=e,this},n.copy=function(e){return this.r=e.r,this.tha=e.tha,this},n.toVector=function(){return new w(this.getX(),this.getY())},n.getX=function(){return this.r*Math.sin(this.tha)},n.getY=function(){return-this.r*Math.cos(this.tha)},n.normalize=function(){return this.r=1,this},n.equals=function(e){return e.r===this.r&&e.tha===this.tha},n.clear=function(){return this.r=0,this.tha=0,this},n.clone=function(){return new r(this.r,this.tha)},r}(),z={create:function(r){var n=new Float32Array(9);return r&&this.set(r,n),n},set:function(r,n){for(var e=0;e<9;e++)n[e]=r[e];return n},multiply:function(r,n,e){var t=r[0],i=r[1],a=r[2],s=r[3],o=r[4],h=r[6],C=r[7],R=n[0],k=n[1],N=n[2],W=n[3],H=n[4],K=n[6],J=n[7];return e[0]=R*t+k*s,e[1]=R*i+k*o,e[2]=a*N,e[3]=W*t+H*s,e[4]=W*i+H*o,e[6]=K*t+J*s+h,e[7]=K*i+J*o+C,e},inverse:function(r,n){var e,t=r[0],i=r[1],a=r[3],s=r[4],o=r[6],h=r[7],C=s,R=-a,k=h*a-s*o;return e=1/(t*C+i*R),n[0]=C*e,n[1]=-i*e,n[3]=R*e,n[4]=t*e,n[6]=k*e,n[7]=(-h*t+i*o)*e,n},multiplyVec2:function(r,n,e){var t=n[0],i=n[1];return e[0]=t*r[0]+i*r[3]+r[6],e[1]=t*r[1]+i*r[4]+r[7],e}},Z=function(r){function n(e){var t;return(t=r.call(this)||this)._arr=u.toArray(e),t}return c(n,r),n.prototype.getValue=function(){var e=u.getRandFromArray(this._arr);return e==="random"||e==="Random"?b.randomColor():e},n.createArraySpan=function(e){return e?e instanceof n?e:new n(e):null},n}(m),ft=function(){function r(n,e,t,i){this.x=n,this.y=e,this.width=t,this.height=i,this.bottom=this.y+this.height,this.right=this.x+this.width}return r.prototype.contains=function(n,e){return n<=this.right&&n>=this.x&&e<=this.bottom&&e>=this.y},r}(),gt=function(){function r(e,t){this.numPan=m.setSpanValue(u.initValue(e,1)),this.timePan=m.setSpanValue(u.initValue(t,1)),this.startTime=0,this.nextTime=0,this.init()}var n=r.prototype;return n.init=function(){this.startTime=0,this.nextTime=this.timePan.getValue()},n.getValue=function(e){return this.startTime+=e,this.startTime>=this.nextTime?(this.startTime=0,this.nextTime=this.timePan.getValue(),this.numPan.b===1?this.numPan.getValue(!1)>.5?1:0:this.numPan.getValue(!0)):0},r}(),q=function(){function r(){}var n=r.prototype;return n.reset=function(){},n.init=function(e,t){t?this.initialize(t):this.initialize(e)},n.initialize=function(e){},r}(),Ct=function(r){function n(e,t,i){var a;return(a=r.call(this)||this).lifePan=m.setSpanValue(e,t,i),a.name="Life",a}return c(n,r),n.prototype.initialize=function(e){this.lifePan.a===1/0?e.life=1/0:e.life=this.lifePan.getValue()},n}(q),Q=function(){function r(){this.vector=new w(0,0),this.random=0,this.crossType="dead",this.alert=!0}var n=r.prototype;return n.getPosition=function(){},n.crossing=function(e){},n.destroy=function(){this.vector=null},r}(),nt=function(r){function n(t,i){var a;return(a=r.call(this)||this).x=t,a.y=i,a}c(n,r);var e=n.prototype;return e.getPosition=function(){return this.vector.x=this.x,this.vector.y=this.y,this.vector},e.crossing=function(t){this.alert&&(console.error("Sorry, PointZone does not support crossing method!"),this.alert=!1)},n}(Q),St=function(r){function n(t){var i;return(i=r.call(this)||this).zone=u.initValue(t,new nt),i.name="Position",i}c(n,r);var e=n.prototype;return e.reset=function(t){this.zone=u.initValue(t,new nt)},e.initialize=function(t){this.zone.getPosition(),t.p.x=this.zone.vector.x,t.p.y=this.zone.vector.y},n}(q),Dt=function(r){function n(t,i,a){var s;return(s=r.call(this)||this).rPan=m.setSpanValue(t),s.thaPan=m.setSpanValue(i),s.type=u.initValue(a,"vector"),s.name="Velocity",s}c(n,r);var e=n.prototype;return e.reset=function(t,i,a){this.rPan=m.setSpanValue(t),this.thaPan=m.setSpanValue(i),this.type=u.initValue(a,"vector")},e.normalizeVelocity=function(t){return t*l.MEASURE},e.initialize=function(t){if(this.type==="p"||this.type==="P"||this.type==="polar"){var i=new pt(this.normalizeVelocity(this.rPan.getValue()),this.thaPan.getValue()*b.PI_180);t.v.x=i.getX(),t.v.y=i.getY()}else t.v.x=this.normalizeVelocity(this.rPan.getValue()),t.v.y=this.normalizeVelocity(this.thaPan.getValue())},n}(q),Mt=function(r){function n(e,t,i){var a;return(a=r.call(this)||this).massPan=m.setSpanValue(e,t,i),a.name="Mass",a}return c(n,r),n.prototype.initialize=function(e){e.mass=this.massPan.getValue()},n}(q),Vt=function(r){function n(t,i,a){var s;return(s=r.call(this)||this).radius=m.setSpanValue(t,i,a),s.name="Radius",s}c(n,r);var e=n.prototype;return e.reset=function(t,i,a){this.radius=m.setSpanValue(t,i,a)},e.initialize=function(t){t.radius=this.radius.getValue(),t.data.oldRadius=t.radius},n}(q),Bt=function(r){function n(t,i,a){var s;return(s=r.call(this)||this).image=s.setSpanValue(t),s.w=u.initValue(i,20),s.h=u.initValue(a,s.w),s.name="Body",s}c(n,r);var e=n.prototype;return e.initialize=function(t){var i=this.image.getValue();t.body=typeof i=="string"?{width:this.w,height:this.h,src:i,isInner:!0,inner:!0}:i},e.setSpanValue=function(t){return t instanceof Z?t:new Z(t)},n}(q),F=function(){function r(e,t){this.life=u.initValue(e,1/0),this.easing=j.getEasing(t),this.age=0,this.energy=1,this.dead=!1,this.parents=[],this.id="Behaviour_"+r.id++,this.name="Behaviour"}var n=r.prototype;return n.reset=function(e,t){this.life=u.initValue(e,1/0),this.easing=j.getEasing(t)},n.normalizeForce=function(e){return e.multiplyScalar(l.MEASURE)},n.normalizeValue=function(e){return e*l.MEASURE},n.initialize=function(e){},n.calculate=function(e,t,i){if(this.age+=t,this.age>=this.life||this.dead)this.energy=0,this.dead=!0,this.destroy();else{var a=this.easing(e.age/e.life);this.energy=Math.max(1-a,0)}},n.applyBehaviour=function(e,t,i){this.calculate(e,t,i)},n.destroy=function(){for(var e=this.parents.length;e--;)this.parents[e].removeBehaviour(this);this.parents.length=0},r}();F.id=0;var yt=function(r){function n(t,i,a,s){var o;return(o=r.call(this,a,s)||this).force=o.normalizeForce(new w(t,i)),o.name="Force",o}c(n,r);var e=n.prototype;return e.reset=function(t,i,a,s){this.force=this.normalizeForce(new w(t,i)),a&&r.prototype.reset.call(this,a,s)},e.applyBehaviour=function(t,i,a){this.calculate(t,i,a),t.a.add(this.force)},n}(F),mt=function(r){function n(t,i,a,s,o){var h;return(h=r.call(this,s,o)||this).targetPosition=u.initValue(t,new w),h.radius=u.initValue(a,1e3),h.force=u.initValue(h.normalizeValue(i),100),h.radiusSq=h.radius*h.radius,h.attractionForce=new w,h.lengthSq=0,h.name="Attraction",h}c(n,r);var e=n.prototype;return e.reset=function(t,i,a,s,o){this.targetPosition=u.initValue(t,new w),this.radius=u.initValue(a,1e3),this.force=u.initValue(this.normalizeValue(i),100),this.radiusSq=this.radius*this.radius,this.attractionForce=new w,this.lengthSq=0,s&&r.prototype.reset.call(this,s,o)},e.applyBehaviour=function(t,i,a){this.calculate(t,i,a),this.attractionForce.copy(this.targetPosition),this.attractionForce.sub(t.p),this.lengthSq=this.attractionForce.lengthSq(),this.lengthSq>4e-5&&this.lengthSq<this.radiusSq&&(this.attractionForce.normalize(),this.attractionForce.multiplyScalar(1-this.lengthSq/this.radiusSq),this.attractionForce.multiplyScalar(this.force),t.a.add(this.attractionForce))},n}(F),Lt=function(r){function n(t,i,a,s,o){var h;return(h=r.call(this,s,o)||this).reset(t,i,a),h.time=0,h.name="RandomDrift",h}c(n,r);var e=n.prototype;return e.reset=function(t,i,a,s,o){this.panFoce=new w(t,i),this.panFoce=this.normalizeForce(this.panFoce),this.delay=a,s&&r.prototype.reset.call(this,s,o)},e.initialize=function(t){t.data.time=0},e.applyBehaviour=function(t,i,a){this.calculate(t,i,a),t.data.time+=i,t.data.time>=this.delay&&(t.a.addXY(b.randomAToB(-this.panFoce.x,this.panFoce.x),b.randomAToB(-this.panFoce.y,this.panFoce.y)),t.data.time=0)},n}(F),Ut=function(r){function n(e,t,i){var a;return(a=r.call(this,0,e,t,i)||this).name="Gravity",a}return c(n,r),n.prototype.reset=function(e,t,i){r.prototype.reset.call(this,0,e,t,i)},n}(yt),Ot=function(r){function n(t,i,a,s,o){var h;return(h=r.call(this,s,o)||this).reset(t,i,a),h.newPool=[],h.pool=[],h.name="Collision",h}c(n,r);var e=n.prototype;return e.reset=function(t,i,a,s,o){this.emitter=u.initValue(t,null),this.mass=u.initValue(i,!0),this.callback=u.initValue(a,null),this.collisionPool=[],this.delta=new w,s&&r.prototype.reset.call(this,s,o)},e.applyBehaviour=function(t,i,a){this.emitter?u.sliceArray(this.emitter.particles,a,this.newPool):u.sliceArray(this.pool,a,this.newPool);var s,o,h,C,R,k,N,W=this.newPool.length;for(N=0;N<W;N++)if((s=this.newPool[N])!==t){this.delta.copy(s.p),this.delta.sub(t.p),o=this.delta.lengthSq();var H=t.radius+s.radius;o<=H*H&&(h=H-Math.sqrt(o),h+=.5,C=t.mass+s.mass,R=this.mass?s.mass/C:.5,k=this.mass?t.mass/C:.5,t.p.add(this.delta.clone().normalize().multiplyScalar(h*-R)),s.p.add(this.delta.normalize().multiplyScalar(h*k)),this.callback&&this.callback(t,s))}},n}(F),Ft=function(r){function n(t,i,a,s){var o;return(o=r.call(this,a,s)||this).reset(t,i),o.name="CrossZone",o}c(n,r);var e=n.prototype;return e.reset=function(t,i,a,s){this.zone=t,this.zone.crossType=u.initValue(i,"dead"),a&&r.prototype.reset.call(this,a,s)},e.applyBehaviour=function(t,i,a){this.calculate(t,i,a),this.zone.crossing(t)},n}(F),zt=function(r){function n(t,i,a,s){var o;return(o=r.call(this,a,s)||this).reset(t,i),o.name="Alpha",o}c(n,r);var e=n.prototype;return e.reset=function(t,i,a,s){this.same=i==null,this.a=m.setSpanValue(u.initValue(t,1)),this.b=m.setSpanValue(i),a&&r.prototype.reset.call(this,a,s)},e.initialize=function(t){t.data.alphaA=this.a.getValue(),this.same?t.data.alphaB=t.data.alphaA:t.data.alphaB=this.b.getValue()},e.applyBehaviour=function(t,i,a){this.calculate(t,i,a),t.alpha=t.data.alphaB+(t.data.alphaA-t.data.alphaB)*this.energy,t.alpha<.001&&(t.alpha=0)},n}(F),kt=function(r){function n(t,i,a,s){var o;return(o=r.call(this,a,s)||this).reset(t,i),o.name="Scale",o}c(n,r);var e=n.prototype;return e.reset=function(t,i,a,s){this.same=i==null,this.a=m.setSpanValue(u.initValue(t,1)),this.b=m.setSpanValue(i),a&&r.prototype.reset.call(this,a,s)},e.initialize=function(t){t.data.scaleA=this.a.getValue(),t.data.oldRadius=t.radius,t.data.scaleB=this.same?t.data.scaleA:this.b.getValue()},e.applyBehaviour=function(t,i,a){this.calculate(t,i,a),t.scale=t.data.scaleB+(t.data.scaleA-t.data.scaleB)*this.energy,t.scale<1e-4&&(t.scale=0),t.radius=t.data.oldRadius*t.scale},n}(F),Nt=function(r){function n(t,i,a,s,o){var h;return(h=r.call(this,s,o)||this).reset(t,i,a),h.name="Rotate",h}c(n,r);var e=n.prototype;return e.reset=function(t,i,a,s,o){this.same=i==null,this.a=m.setSpanValue(u.initValue(t,"Velocity")),this.b=m.setSpanValue(u.initValue(i,0)),this.style=u.initValue(a,"to"),s&&r.prototype.reset.call(this,s,o)},e.initialize=function(t){t.rotation=this.a.getValue(),t.data.rotationA=this.a.getValue(),this.same||(t.data.rotationB=this.b.getValue())},e.applyBehaviour=function(t,i,a){this.calculate(t,i,a),this.same?this.a.a!=="V"&&this.a.a!=="Velocity"&&this.a.a!=="v"||(t.rotation=t.getDirection()):this.style==="to"||this.style==="TO"||this.style==="_"?t.rotation+=t.data.rotationB+(t.data.rotationA-t.data.rotationB)*this.energy:t.rotation+=t.data.rotationB},n}(F),Ht=function(r){function n(t,i,a,s){var o;return(o=r.call(this,a,s)||this).reset(t,i),o.name="Color",o}c(n,r);var e=n.prototype;return e.reset=function(t,i,a,s){this.a=Z.createArraySpan(t),this.b=Z.createArraySpan(i),a&&r.prototype.reset.call(this,a,s)},e.initialize=function(t){t.color=this.a.getValue(),t.data.colorA=Y.hexToRgb(t.color),this.b&&(t.data.colorB=Y.hexToRgb(this.b.getValue()))},e.applyBehaviour=function(t,i,a){this.b?(this.calculate(t,i,a),t.rgb.r=t.data.colorB.r+(t.data.colorA.r-t.data.colorB.r)*this.energy,t.rgb.g=t.data.colorB.g+(t.data.colorA.g-t.data.colorB.g)*this.energy,t.rgb.b=t.data.colorB.b+(t.data.colorA.b-t.data.colorB.b)*this.energy,t.rgb.r=t.rgb.r<<0,t.rgb.g=t.rgb.g<<0,t.rgb.b=t.rgb.b<<0):(t.rgb.r=t.data.colorA.r,t.rgb.g=t.data.colorA.g,t.rgb.b=t.data.colorA.b)},n}(F),ht="changing",Gt=function(r){function n(t,i,a,s){var o;return(o=r.call(this,a,s)||this).setAngleAndForce(t,i),o.name="Cyclone",o}c(n,r);var e=n.prototype;return e.setAngleAndForce=function(t,i){this.force=ht,this.angle=b.PI/2,t==="right"?this.angle=b.PI/2:t==="left"?this.angle=-b.PI/2:t==="random"?this.angle="random":t instanceof m?(this.angle="span",this.span=t):t&&(this.angle=t),String(i).toLowerCase()==="changing"||String(i).toLowerCase()==="chang"||String(i).toLowerCase()==="auto"?this.force=ht:i&&(this.force=i)},e.reset=function(t,i,a,s){this.angle=b.PI/2,this.setAngleAndForce(t,i),a&&r.prototype.reset.call(this,a,s)},e.initialize=function(t){this.angle==="random"?t.data.cangle=b.randomAToB(-b.PI,b.PI):this.angle==="span"&&(t.data.cangle=this.span.getValue()),t.data.cyclone=new w(0,0)},e.applyBehaviour=function(t,i,a){var s;this.calculate(t,i,a);var o=t.v.getGradient();this.angle==="random"||this.angle==="span"?o+=t.data.cangle:o+=this.angle,s=this.force===ht?t.v.length()/100:this.force,t.data.cyclone.x=s*Math.cos(o),t.data.cyclone.y=s*Math.sin(o),t.data.cyclone=this.normalizeForce(t.data.cyclone),t.a.add(t.data.cyclone)},n}(F),qt=function(r){function n(e,t,i,a,s){var o;return(o=r.call(this,e,t,i,a,s)||this).force*=-1,o.name="Repulsion",o}return c(n,r),n.prototype.reset=function(e,t,i,a,s){r.prototype.reset.call(this,e,t,i,a,s),this.force*=-1},n}(mt),Wt=function(r){function n(t,i,a,s){var o;return(o=r.call(this,a,s)||this).distanceVec=new w,o.centerPoint=u.initValue(t,new w),o.force=u.initValue(o.normalizeValue(i),100),o.name="GravityWell",o}c(n,r);var e=n.prototype;return e.reset=function(t,i,a,s){this.distanceVec=new w,this.centerPoint=u.initValue(t,new w),this.force=u.initValue(this.normalizeValue(i),100),a&&r.prototype.reset.call(this,a,s)},e.initialize=function(t){},e.applyBehaviour=function(t,i,a){this.distanceVec.set(this.centerPoint.x-t.p.x,this.centerPoint.y-t.p.y);var s=this.distanceVec.lengthSq();if(s!==0){var o=this.distanceVec.length(),h=this.force*i/(s*o);t.v.x+=h*this.distanceVec.x,t.v.y+=h*this.distanceVec.y}},n}(F),jt={initialize:function(r,n,e){var t,i=e.length;for(t=0;t<i;t++)e[t]instanceof q?e[t].init(r,n):this.init(r,n,e[t]);this.bindEmitter(r,n)},init:function(r,n,e){et.setProp(n,e),et.setVectorVal(n,e)},bindEmitter:function(r,n){r.bindEmitter&&(n.p.add(r.p),n.v.add(r.v),n.a.add(r.a),n.v.rotate(b.degreeTransform(r.rotation)))}},at=function(r){function n(t){var i;return t===void 0&&(t={}),(i=r.call(this,t)||this).particles=[],i.behaviours=[],i.initializes=[],i.emitTime=0,i.emitSpeed=0,i.totalTime=-1,i.damping=.006,i.bindEmitter=!0,i.rate=new gt(1,.1),i.name="Emitter",i.id=$.id(i.name),i}c(n,r);var e=n.prototype;return e.emit=function(t,i){this.stoped=!1,this.emitTime=0,this.totalTime=u.initValue(t,1/0),i===!0||i==="life"||i==="destroy"?this.life=t==="once"?1:this.totalTime:isNaN(i)||(this.life=i),this.rate.init()},e.stop=function(){this.totalTime=-1,this.emitTime=0,this.stoped=!0},e.preEmit=function(t){var i=this.stoped,a=this.emitTime,s=this.totalTime;this.stoped=!1,this.emitTime=0,this.totalTime=t,this.rate.init();for(var o=.0167;t>o;)t-=o,this.update(o);this.stoped=i,this.emitTime=a+Math.max(t,0),this.totalTime=s},e.removeAllParticles=function(){for(var t=this.particles.length;t--;)this.particles[t].dead=!0},e.addSelfInitialize=function(t){t.init&&t.init(this)},e.addInitialize=function(){for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];for(var s=i.length;s--;)this.initializes.push(i[s])},e.removeInitialize=function(t){var i=this.initializes.indexOf(t);i>-1&&this.initializes.splice(i,1)},e.removeAllInitializers=function(){u.emptyArray(this.initializes)},e.addBehaviour=function(){for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];for(var s=arguments.length;s--;){var o=i[s];this.behaviours.push(o),o.parents&&o.parents.push(this)}},e.removeBehaviour=function(t){var i=this.behaviours.indexOf(t);return this.behaviours.splice(i,1),t.parents&&(i=t.parents.indexOf(t),t.parents.splice(i,1)),i},e.removeAllBehaviours=function(){u.emptyArray(this.behaviours)},e.update=function(t){this.age+=t,(this.age>=this.life||this.dead)&&this.destroy(),this.emitting(t),this.integrate(t)},e.integrate=function(t){if(this.parent){var i,a,s=1-this.damping;for(this.parent.integrator.calculate(this,t,s),i=this.particles.length-1;i>=0;i--)(a=this.particles[i]).update(t,i),this.parent.integrator.calculate(a,t,s),this.dispatch("PARTICLE_UPDATE",a),a.dead&&(this.dispatch("PARTICLE_DEAD",a),this.parent.pool.expire(a),this.particles.splice(i,1))}},e.dispatch=function(t,i){this.parent&&this.parent.dispatchEvent(t,i),this.bindEvent&&this.dispatchEvent(t,i)},e.emitting=function(t){if(!this.stoped){if(this.totalTime==="none")this.emitTime+=t;else if(this.totalTime==="once"){var i,a=this.rate.getValue(99999);for(a>0&&(this.emitSpeed=a),i=0;i<a;i++)this.createParticle();this.totalTime="none"}else if(this.emitTime+=t,this.emitTime<this.totalTime){var s,o=this.rate.getValue(t);for(o>0&&(this.emitSpeed=o),s=0;s<o;s++)this.createParticle()}}},e.createParticle=function(t,i){var a=this.parent.pool.get(ot);return this.setupParticle(a,t,i),this.dispatch("PARTICLE_CREATED",a),a},e.setupParticle=function(t,i,a){var s=this.initializes,o=this.behaviours;i&&(s=u.toArray(i)),a&&(o=u.toArray(a)),t.reset(),jt.initialize(this,t,s),t.addBehaviours(o),t.parent=this,this.particles.push(t)},e.remove=function(){this.stop(),u.destroyAll(this.particles)},e.destroy=function(){this.dead=!0,this.remove(),this.removeAllInitializers(),this.removeAllBehaviours(),this.parent&&this.parent.removeEmitter(this),this.rate=null,this.old=null,this.rgb=null,this.v=null,this.a=null,this.p=null},n}(ot);rt.bind(at);var it,Xt=function(r){function n(t){var i;return(i=r.call(this,t)||this).selfBehaviours=[],i}c(n,r);var e=n.prototype;return e.addSelfBehaviour=function(){for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];var s,o=i.length;for(s=0;s<o;s++){var h=i[s];this.selfBehaviours.push(h),h.initialize(this)}},e.removeSelfBehaviour=function(t){var i=this.selfBehaviours.indexOf(t);i>-1&&this.selfBehaviours.splice(i,1)},e.update=function(t){if(r.prototype.update.call(this,t),!this.sleep){var i,a=this.selfBehaviours.length;for(i=0;i<a;i++)this.selfBehaviours[i].applyBehaviour(this,t,i)}},n}(at),Yt=function(r){function n(t,i,a){var s;return(s=r.call(this,a)||this).mouseTarget=u.initValue(t,window),s.ease=u.initValue(i,.7),s._allowEmitting=!1,s.initEventHandler(),s}c(n,r);var e=n.prototype;return e.initEventHandler=function(){var t=this;this.mousemoveHandler=function(i){return t.mousemove.call(t,i)},this.mousedownHandler=function(i){return t.mousedown.call(t,i)},this.mouseupHandler=function(i){return t.mouseup.call(t,i)},this.mouseTarget.addEventListener("mousemove",this.mousemoveHandler,!1)},e.emit=function(){this._allowEmitting=!0},e.stop=function(){this._allowEmitting=!1},e.mousemove=function(t){t.layerX||t.layerX===0?(this.p.x+=(t.layerX-this.p.x)*this.ease,this.p.y+=(t.layerY-this.p.y)*this.ease):(t.offsetX||t.offsetX===0)&&(this.p.x+=(t.offsetX-this.p.x)*this.ease,this.p.y+=(t.offsetY-this.p.y)*this.ease),this._allowEmitting&&r.prototype.emit.call(this,"once")},e.destroy=function(){r.prototype.destroy.call(this),this.mouseTarget.removeEventListener("mousemove",this.mousemoveHandler,!1)},n}(at),vt=function(r){if(!r)return!1;if(r.__isImage)return!0;var n=(""+r.tagName).toUpperCase();return((""+r.nodeName).toUpperCase()==="IMG"||n==="IMG")&&(r.__isImage=!0,!0)},bt=function(r){return typeof r=="string"},X=function(){function r(e,t){this.pool=new tt,this.element=e,this.stroke=t,this.circleConf={isCircle:!0},this.initEventHandler(),this.name="BaseRenderer"}var n=r.prototype;return n.setStroke=function(e,t){e===void 0&&(e="#000000"),t===void 0&&(t=1),this.stroke={color:e,thinkness:t}},n.initEventHandler=function(){var e=this;this._protonUpdateHandler=function(){e.onProtonUpdate.call(e)},this._protonUpdateAfterHandler=function(){e.onProtonUpdateAfter.call(e)},this._emitterAddedHandler=function(t){e.onEmitterAdded.call(e,t)},this._emitterRemovedHandler=function(t){e.onEmitterRemoved.call(e,t)},this._particleCreatedHandler=function(t){e.onParticleCreated.call(e,t)},this._particleUpdateHandler=function(t){e.onParticleUpdate.call(e,t)},this._particleDeadHandler=function(t){e.onParticleDead.call(e,t)}},n.init=function(e){this.parent=e,e.addEventListener("PROTON_UPDATE",this._protonUpdateHandler),e.addEventListener("PROTON_UPDATE_AFTER",this._protonUpdateAfterHandler),e.addEventListener("EMITTER_ADDED",this._emitterAddedHandler),e.addEventListener("EMITTER_REMOVED",this._emitterRemovedHandler),e.addEventListener("PARTICLE_CREATED",this._particleCreatedHandler),e.addEventListener("PARTICLE_UPDATE",this._particleUpdateHandler),e.addEventListener("PARTICLE_DEAD",this._particleDeadHandler)},n.resize=function(e,t){},n.destroy=function(){this.remove(),this.pool.destroy(),this.pool=null,this.element=null,this.stroke=null},n.remove=function(e){this.parent.removeEventListener("PROTON_UPDATE",this._protonUpdateHandler),this.parent.removeEventListener("PROTON_UPDATE_AFTER",this._protonUpdateAfterHandler),this.parent.removeEventListener("EMITTER_ADDED",this._emitterAddedHandler),this.parent.removeEventListener("EMITTER_REMOVED",this._emitterRemovedHandler),this.parent.removeEventListener("PARTICLE_CREATED",this._particleCreatedHandler),this.parent.removeEventListener("PARTICLE_UPDATE",this._particleUpdateHandler),this.parent.removeEventListener("PARTICLE_DEAD",this._particleDeadHandler),this.parent=null},n.onProtonUpdate=function(){},n.onProtonUpdateAfter=function(){},n.onEmitterAdded=function(e){},n.onEmitterRemoved=function(e){},n.onParticleCreated=function(e){},n.onParticleUpdate=function(e){},n.onParticleDead=function(e){},r}(),Zt=function(r){function n(t){var i;return(i=r.call(this,t)||this).stroke=null,i.context=i.element.getContext("2d"),i.bufferCache={},i.name="CanvasRenderer",i}c(n,r);var e=n.prototype;return e.resize=function(t,i){this.element.width=t,this.element.height=i},e.onProtonUpdate=function(){this.context.clearRect(0,0,this.element.width,this.element.height)},e.onParticleCreated=function(t){t.body?y(t.body,this.addImg2Body,t):t.color=t.color||"#ff0000"},e.onParticleUpdate=function(t){t.body?vt(t.body)&&this.drawImage(t):this.drawCircle(t)},e.onParticleDead=function(t){t.body=null},e.addImg2Body=function(t,i){i.body=t},e.drawImage=function(t){var i=t.body.width*t.scale|0,a=t.body.height*t.scale|0,s=t.p.x-i/2,o=t.p.y-a/2;if(t.color){t.data.buffer||(t.data.buffer=this.createBuffer(t.body));var h=t.data.buffer.getContext("2d");h.clearRect(0,0,t.data.buffer.width,t.data.buffer.height),h.globalAlpha=t.alpha,h.drawImage(t.body,0,0),h.globalCompositeOperation="source-atop",h.fillStyle=Y.rgbToHex(t.rgb),h.fillRect(0,0,t.data.buffer.width,t.data.buffer.height),h.globalCompositeOperation="source-over",h.globalAlpha=1,this.context.drawImage(t.data.buffer,0,0,t.data.buffer.width,t.data.buffer.height,s,o,i,a)}else this.context.save(),this.context.globalAlpha=t.alpha,this.context.translate(t.p.x,t.p.y),this.context.rotate(b.degreeTransform(t.rotation)),this.context.translate(-t.p.x,-t.p.y),this.context.drawImage(t.body,0,0,t.body.width,t.body.height,s,o,i,a),this.context.globalAlpha=1,this.context.restore()},e.drawCircle=function(t){t.rgb?this.context.fillStyle="rgba("+t.rgb.r+","+t.rgb.g+","+t.rgb.b+","+t.alpha+")":this.context.fillStyle=t.color,this.context.beginPath(),this.context.arc(t.p.x,t.p.y,t.radius,0,2*Math.PI,!0),this.stroke&&(this.context.strokeStyle=this.stroke.color,this.context.lineWidth=this.stroke.thinkness,this.context.stroke()),this.context.closePath(),this.context.fill()},e.createBuffer=function(t){if(vt(t)){var i=t.width+"_"+t.height,a=this.bufferCache[i];return a||((a=document.createElement("canvas")).width=t.width,a.height=t.height,this.bufferCache[i]=a),a}},e.destroy=function(){r.prototype.destroy.call(this),this.stroke=null,this.context=null,this.bufferCache=null},n}(X),Qt=function(r){function n(t){var i;return(i=r.call(this,t)||this).stroke=null,i.transform3d=!1,i.pool.create=function(a,s){return i.createBody(a,s)},i.addImg2Body=i.addImg2Body.bind(v(i)),i.name="DomRenderer",i}c(n,r);var e=n.prototype;return e.onParticleCreated=function(t){t.body?y(t.body,this.addImg2Body,t):(t.body=this.pool.get(this.circleConf,t),this.element.appendChild(t.body))},e.onParticleUpdate=function(t){this.bodyReady(t)&&(this.transform3d?B.transform3d(t.body,t.p.x,t.p.y,t.scale,t.rotation):B.transform(t.body,t.p.x,t.p.y,t.scale,t.rotation),t.body.style.opacity=t.alpha,t.body.isCircle&&(t.body.style.backgroundColor=t.color||"#ff0000"))},e.onParticleDead=function(t){this.bodyReady(t)&&(this.element.removeChild(t.body),this.pool.expire(t.body),t.body=null)},e.bodyReady=function(t){return typeof t.body=="object"&&t.body&&!t.body.isInner},e.addImg2Body=function(t,i){i.dead||(i.body=this.pool.get(t,i),B.resize(i.body,t.width,t.height),this.element.appendChild(i.body))},e.createBody=function(t,i){return t.isCircle?this.createCircle(i):this.createSprite(t,i)},e.createCircle=function(t){var i=B.createDiv(t.id+"_dom",2*t.radius,2*t.radius);return i.style.borderRadius=t.radius+"px",this.stroke&&(i.style.borderColor=this.stroke.color,i.style.borderWidth=this.stroke.thinkness+"px"),i.isCircle=!0,i},e.createSprite=function(t,i){var a=typeof t=="string"?t:t.src,s=B.createDiv(i.id+"_dom",t.width,t.height);return s.style.backgroundImage="url("+a+")",s},e.destroy=function(){r.prototype.destroy.call(this),this.stroke=null},n}(X),Kt=function(r){function n(t,i){var a;return(a=r.call(this,t)||this).stroke=i,a.name="EaselRenderer",a}c(n,r);var e=n.prototype;return e.onParticleCreated=function(t){t.body?this.createSprite(t):this.createCircle(t),this.element.addChild(t.body)},e.onParticleUpdate=function(t){t.body&&(t.body.x=t.p.x,t.body.y=t.p.y,t.body.alpha=t.alpha,t.body.scaleX=t.body.scaleY=t.scale,t.body.rotation=t.rotation)},e.onParticleDead=function(t){t.body&&(t.body.parent&&t.body.parent.removeChild(t.body),this.pool.expire(t.body),t.body=null),t.graphics&&this.pool.expire(t.graphics)},e.createSprite=function(t){t.body=this.pool.get(t.body),t.body.parent||t.body.image&&(t.body.regX=t.body.image.width/2,t.body.regY=t.body.image.height/2)},e.createCircle=function(t){var i=this.pool.get(window.createjs.Graphics);this.stroke&&(bt(this.stroke)?i.beginStroke(this.stroke):i.beginStroke("#000000")),i.beginFill(t.color||"#ff0000").drawCircle(0,0,t.radius);var a=this.pool.get(window.createjs.Shape,[i]);t.body=a,t.graphics=i},e.destroy=function(){r.prototype.destroy.call(this),this.stroke=null},n}(X),Jt=function(r){function n(t,i){var a;return(a=r.call(this,t)||this).context=a.element.getContext("2d"),a.imageData=null,a.rectangle=i,a.createImageData(i),a.name="PixelRenderer",a}c(n,r);var e=n.prototype;return e.resize=function(t,i){this.element.width=t,this.element.height=i},e.createImageData=function(t){this.rectangle=t||new ft(0,0,this.element.width,this.element.height),this.imageData=this.context.createImageData(this.rectangle.width,this.rectangle.height),this.context.putImageData(this.imageData,this.rectangle.x,this.rectangle.y)},e.onProtonUpdate=function(){this.context.clearRect(this.rectangle.x,this.rectangle.y,this.rectangle.width,this.rectangle.height),this.imageData=this.context.getImageData(this.rectangle.x,this.rectangle.y,this.rectangle.width,this.rectangle.height)},e.onProtonUpdateAfter=function(){this.context.putImageData(this.imageData,this.rectangle.x,this.rectangle.y)},e.onParticleCreated=function(t){},e.onParticleUpdate=function(t){this.imageData&&this.setPixel(this.imageData,t.p.x-this.rectangle.x>>0,t.p.y-this.rectangle.y>>0,t)},e.setPixel=function(t,i,a,s){var o=s.rgb;if(!(i<0||i>this.element.width||a<0||a>this.element.height)){var h=4*((a>>0)*t.width+(i>>0));t.data[h]=o.r,t.data[h+1]=o.g,t.data[h+2]=o.b,t.data[h+3]=255*s.alpha}},e.onParticleDead=function(t){},e.destroy=function(){r.prototype.destroy.call(this),this.stroke=null,this.context=null,this.imageData=null,this.rectangle=null},n}(X),$t=function(r){function n(t,i){var a;return(a=r.call(this,t)||this).stroke=i,a.color=!1,a.setColor=!1,a.blendMode=null,a.pool.create=function(s,o){return a.createBody(s,o)},a.setPIXI(window.PIXI),a.name="PixiRenderer",a}c(n,r);var e=n.prototype;return e.setPIXI=function(t){try{it=t||{Sprite:{}},this.createFromImage=it.Sprite.from||it.Sprite.fromImage}catch{}},e.onProtonUpdate=function(){},e.onParticleCreated=function(t){t.body?t.body=this.pool.get(t.body,t):t.body=this.pool.get(this.circleConf,t),this.blendMode&&(t.body.blendMode=this.blendMode),this.element.addChild(t.body)},e.onParticleUpdate=function(t){this.transform(t,t.body),this.setColor!==!0&&this.color!==!0||(t.body.tint=Y.getHex16FromParticle(t))},e.onParticleDead=function(t){this.element.removeChild(t.body),this.pool.expire(t.body),t.body=null},e.transform=function(t,i){i.x=t.p.x,i.y=t.p.y,i.alpha=t.alpha,i.scale.x=t.scale,i.scale.y=t.scale,i.rotation=t.rotation*b.PI_180},e.createBody=function(t,i){return t.isCircle?this.createCircle(i):this.createSprite(t)},e.createSprite=function(t){var i=t.isInner?this.createFromImage(t.src):new it.Sprite(t);return i.anchor.x=.5,i.anchor.y=.5,i},e.createCircle=function(t){var i=new it.Graphics;if(this.stroke){var a=bt(this.stroke)?this.stroke:0;i.beginStroke(a)}return i.beginFill(t.color||36077),i.drawCircle(0,0,t.radius),i.endFill(),i},e.destroy=function(t){r.prototype.destroy.call(this);for(var i=t.length;i--;){var a=t[i];a.body&&this.element.removeChild(a.body)}},n}(X),te=function(){function r(){this.mats=[],this.size=0;for(var e=0;e<20;e++)this.mats.push(z.create([0,0,0,0,0,0,0,0,0]))}var n=r.prototype;return n.set=function(e,t){t===0?z.set(e,this.mats[0]):z.multiply(this.mats[t-1],e,this.mats[t]),this.size=Math.max(this.size,t+1)},n.push=function(e){this.size===0?z.set(e,this.mats[0]):z.multiply(this.mats[this.size-1],e,this.mats[this.size]),this.size++},n.pop=function(){this.size>0&&this.size--},n.top=function(){return this.mats[this.size-1]},r}(),ee=function(r){function n(t){var i;return(i=r.call(this,t)||this).gl=i.element.getContext("experimental-webgl",{antialias:!0,stencil:!1,depth:!1}),i.gl||alert("Sorry your browser do not suppest WebGL!"),i.initVar(),i.setMaxRadius(),i.initShaders(),i.initBuffers(),i.gl.blendEquation(i.gl.FUNC_ADD),i.gl.blendFunc(i.gl.SRC_ALPHA,i.gl.ONE_MINUS_SRC_ALPHA),i.gl.enable(i.gl.BLEND),i.addImg2Body=i.addImg2Body.bind(v(i)),i.name="WebGLRenderer",i}c(n,r);var e=n.prototype;return e.init=function(t){r.prototype.init.call(this,t),this.resize(this.element.width,this.element.height)},e.resize=function(t,i){this.umat[4]=-2,this.umat[7]=1,this.smat[0]=1/t,this.smat[4]=1/i,this.mstack.set(this.umat,0),this.mstack.set(this.smat,1),this.gl.viewport(0,0,t,i),this.element.width=t,this.element.height=i},e.setMaxRadius=function(t){this.circleCanvasURL=this.createCircle(t)},e.getVertexShader=function(){return["uniform vec2 viewport;","attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform mat3 tMat;","varying vec2 vTextureCoord;","varying float alpha;","void main() {","vec3 v = tMat * vec3(aVertexPosition, 1.0);","gl_Position = vec4(v.x, v.y, 0, 1);","vTextureCoord = aTextureCoord;","alpha = tMat[0][2];","}"].join(`
`)},e.getFragmentShader=function(){return["precision mediump float;","varying vec2 vTextureCoord;","varying float alpha;","uniform sampler2D uSampler;","uniform vec4 color;","uniform bool useTexture;","uniform vec3 uColor;","void main() {","vec4 textureColor = texture2D(uSampler, vTextureCoord);","gl_FragColor = textureColor * vec4(uColor, 1.0);","gl_FragColor.w *= alpha;","}"].join(`
`)},e.initVar=function(){this.mstack=new te,this.umat=z.create([2,0,1,0,-2,0,-1,1,1]),this.smat=z.create([.01,0,1,0,.01,0,0,0,1]),this.texturebuffers={}},e.blendEquation=function(t){this.gl.blendEquation(this.gl[t])},e.blendFunc=function(t,i){this.gl.blendFunc(this.gl[t],this.gl[i])},e.getShader=function(t,i,a){var s=a?t.createShader(t.FRAGMENT_SHADER):t.createShader(t.VERTEX_SHADER);return t.shaderSource(s,i),t.compileShader(s),t.getShaderParameter(s,t.COMPILE_STATUS)?s:(alert(t.getShaderInfoLog(s)),null)},e.initShaders=function(){var t=this.getShader(this.gl,this.getFragmentShader(),!0),i=this.getShader(this.gl,this.getVertexShader(),!1);this.sprogram=this.gl.createProgram(),this.gl.attachShader(this.sprogram,i),this.gl.attachShader(this.sprogram,t),this.gl.linkProgram(this.sprogram),this.gl.getProgramParameter(this.sprogram,this.gl.LINK_STATUS)||alert("Could not initialise shaders"),this.gl.useProgram(this.sprogram),this.sprogram.vpa=this.gl.getAttribLocation(this.sprogram,"aVertexPosition"),this.sprogram.tca=this.gl.getAttribLocation(this.sprogram,"aTextureCoord"),this.gl.enableVertexAttribArray(this.sprogram.tca),this.gl.enableVertexAttribArray(this.sprogram.vpa),this.sprogram.tMatUniform=this.gl.getUniformLocation(this.sprogram,"tMat"),this.sprogram.samplerUniform=this.gl.getUniformLocation(this.sprogram,"uSampler"),this.sprogram.useTex=this.gl.getUniformLocation(this.sprogram,"useTexture"),this.sprogram.color=this.gl.getUniformLocation(this.sprogram,"uColor"),this.gl.uniform1i(this.sprogram.useTex,1)},e.initBuffers=function(){var t,i;this.unitIBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.unitIBuffer),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,3,1,0,2,3]),this.gl.STATIC_DRAW);var a=[];for(i=0;i<100;i++)a.push(i);for(t=new Uint16Array(a),this.unitI33=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.unitI33),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,t,this.gl.STATIC_DRAW),a=[],i=0;i<100;i++)a.push(i,i+1,i+2);t=new Uint16Array(a),this.stripBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.stripBuffer),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,t,this.gl.STATIC_DRAW)},e.createCircle=function(t){this.circleCanvasRadius=D(u.initValue(t,32));var i=B.createCanvas("circle_canvas",2*this.circleCanvasRadius,2*this.circleCanvasRadius),a=i.getContext("2d");return a.beginPath(),a.arc(this.circleCanvasRadius,this.circleCanvasRadius,this.circleCanvasRadius,0,2*Math.PI,!0),a.closePath(),a.fillStyle="#FFF",a.fill(),i.toDataURL()},e.drawImg2Canvas=function(t){var i=t.body.width,a=t.body.height,s=D(t.body.width),o=D(t.body.height),h=t.body.width/s,C=t.body.height/o;this.texturebuffers[t.data.src]||(this.texturebuffers[t.data.src]=[this.gl.createTexture(),this.gl.createBuffer(),this.gl.createBuffer()]),t.data.texture=this.texturebuffers[t.data.src][0],t.data.vcBuffer=this.texturebuffers[t.data.src][1],t.data.tcBuffer=this.texturebuffers[t.data.src][2],this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t.data.tcBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([0,0,h,0,0,C,C,C]),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t.data.vcBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([0,0,i,0,0,a,i,a]),this.gl.STATIC_DRAW);var R=t.data.canvas.getContext("2d").getImageData(0,0,s,o);this.gl.bindTexture(this.gl.TEXTURE_2D,t.data.texture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,R),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR_MIPMAP_NEAREST),this.gl.generateMipmap(this.gl.TEXTURE_2D),t.data.textureLoaded=!0,t.data.textureWidth=i,t.data.textureHeight=a},e.onProtonUpdate=function(){},e.onParticleCreated=function(t){t.data.textureLoaded=!1,t.data.tmat=z.create(),t.data.tmat[8]=1,t.data.imat=z.create(),t.data.imat[8]=1,t.body?y(t.body,this.addImg2Body,t):(y(this.circleCanvasURL,this.addImg2Body,t),t.data.oldScale=t.radius/this.circleCanvasRadius)},e.addImg2Body=function(t,i){i.dead||(i.body=t,i.data.src=t.src,i.data.canvas=T(t),i.data.oldScale=1,this.drawImg2Canvas(i))},e.onParticleUpdate=function(t){t.data.textureLoaded&&(this.updateMatrix(t),this.gl.uniform3f(this.sprogram.color,t.rgb.r/255,t.rgb.g/255,t.rgb.b/255),this.gl.uniformMatrix3fv(this.sprogram.tMatUniform,!1,this.mstack.top()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t.data.vcBuffer),this.gl.vertexAttribPointer(this.sprogram.vpa,2,this.gl.FLOAT,!1,0,0),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t.data.tcBuffer),this.gl.vertexAttribPointer(this.sprogram.tca,2,this.gl.FLOAT,!1,0,0),this.gl.bindTexture(this.gl.TEXTURE_2D,t.data.texture),this.gl.uniform1i(this.sprogram.samplerUniform,0),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.unitIBuffer),this.gl.drawElements(this.gl.TRIANGLES,6,this.gl.UNSIGNED_SHORT,0),this.mstack.pop())},e.onParticleDead=function(t){},e.updateMatrix=function(t){var i=O(-t.data.textureWidth/2,-t.data.textureHeight/2),a=O(t.p.x,t.p.y),s=t.rotation*b.PI_180,o=P(s),h=t.scale*t.data.oldScale,C=M(h,h),R=V(i,C);R=V(R,o),R=V(R,a),z.inverse(R,t.data.imat),R[2]=t.alpha,this.mstack.push(R)},e.destroy=function(){r.prototype.destroy.call(this),this.gl=null,this.mstack=null,this.umat=null,this.smat=null,this.texturebuffers=null},n}(X),ie=function(r){function n(e){var t;return(t=r.call(this,e)||this).name="CustomRenderer",t}return c(n,r),n}(X),xt=function(r){function n(t,i,a,s,o){var h;return h=r.call(this)||this,a-t>=0?(h.x1=t,h.y1=i,h.x2=a,h.y2=s):(h.x1=a,h.y1=s,h.x2=t,h.y2=i),h.dx=h.x2-h.x1,h.dy=h.y2-h.y1,h.minx=Math.min(h.x1,h.x2),h.miny=Math.min(h.y1,h.y2),h.maxx=Math.max(h.x1,h.x2),h.maxy=Math.max(h.y1,h.y2),h.dot=h.x2*h.y1-h.x1*h.y2,h.xxyy=h.dx*h.dx+h.dy*h.dy,h.gradient=h.getGradient(),h.length=h.getLength(),h.direction=u.initValue(o,">"),h}c(n,r);var e=n.prototype;return e.getPosition=function(){return this.random=Math.random(),this.vector.x=this.x1+this.random*this.length*Math.cos(this.gradient),this.vector.y=this.y1+this.random*this.length*Math.sin(this.gradient),this.vector},e.getDirection=function(t,i){var a=this.dy,s=-this.dx;return(a*t+s*i+this.dot)*(s===0?1:s)>0},e.getDistance=function(t,i){return(this.dy*t+-this.dx*i+this.dot)/Math.sqrt(this.xxyy)},e.getSymmetric=function(t){var i=t.getGradient(),a=2*(this.getGradient()-i),s=t.x,o=t.y;return t.x=s*Math.cos(a)-o*Math.sin(a),t.y=s*Math.sin(a)+o*Math.cos(a),t},e.getGradient=function(){return Math.atan2(this.dy,this.dx)},e.rangeOut=function(t){if(Math.abs(this.getGradient())<=b.PI/4){if(t.p.x<=this.maxx&&t.p.x>=this.minx)return!0}else if(t.p.y<=this.maxy&&t.p.y>=this.miny)return!0;return!1},e.getLength=function(){return Math.sqrt(this.dx*this.dx+this.dy*this.dy)},e.crossing=function(t){if(this.crossType==="dead")if(this.direction===">"||this.direction==="R"||this.direction==="right"||this.direction==="down"){if(!this.rangeOut(t))return;this.getDirection(t.p.x,t.p.y)&&(t.dead=!0)}else{if(!this.rangeOut(t))return;this.getDirection(t.p.x,t.p.y)||(t.dead=!0)}else if(this.crossType==="bound"){if(!this.rangeOut(t))return;this.getDistance(t.p.x,t.p.y)<=t.radius&&(this.dx===0?t.v.x*=-1:this.dy===0?t.v.y*=-1:this.getSymmetric(t.v))}else this.crossType==="cross"&&this.alert&&(console.error("Sorry, LineZone does not support cross method!"),this.alert=!1)},n}(Q),Et=function(r){function n(t,i,a){var s;return(s=r.call(this)||this).x=t,s.y=i,s.radius=a,s.angle=0,s.center={x:t,y:i},s}c(n,r);var e=n.prototype;return e.getPosition=function(){return this.angle=b.PIx2*Math.random(),this.randomRadius=Math.random()*this.radius,this.vector.x=this.x+this.randomRadius*Math.cos(this.angle),this.vector.y=this.y+this.randomRadius*Math.sin(this.angle),this.vector},e.setCenter=function(t,i){this.center.x=t,this.center.y=i},e.crossing=function(t){var i=t.p.distanceTo(this.center);this.crossType==="dead"?i-t.radius>this.radius&&(t.dead=!0):this.crossType==="bound"?i+t.radius>=this.radius&&this.getSymmetric(t):this.crossType==="cross"&&this.alert&&(console.error("Sorry, CircleZone does not support cross method!"),this.alert=!1)},e.getSymmetric=function(t){var i=t.v.getGradient(),a=2*(this.getGradient(t)-i),s=t.v.x,o=t.v.y;t.v.x=s*Math.cos(a)-o*Math.sin(a),t.v.y=s*Math.sin(a)+o*Math.cos(a)},e.getGradient=function(t){return-b.PI_2+Math.atan2(t.p.y-this.center.y,t.p.x-this.center.x)},n}(Q),At=function(r){function n(t,i,a,s){var o;return(o=r.call(this)||this).x=t,o.y=i,o.width=a,o.height=s,o}c(n,r);var e=n.prototype;return e.getPosition=function(){return this.vector.x=this.x+Math.random()*this.width,this.vector.y=this.y+Math.random()*this.height,this.vector},e.crossing=function(t){this.crossType==="dead"?((t.p.x+t.radius<this.x||t.p.x-t.radius>this.x+this.width)&&(t.dead=!0),(t.p.y+t.radius<this.y||t.p.y-t.radius>this.y+this.height)&&(t.dead=!0)):this.crossType==="bound"?(t.p.x-t.radius<this.x?(t.p.x=this.x+t.radius,t.v.x*=-1):t.p.x+t.radius>this.x+this.width&&(t.p.x=this.x+this.width-t.radius,t.v.x*=-1),t.p.y-t.radius<this.y?(t.p.y=this.y+t.radius,t.v.y*=-1):t.p.y+t.radius>this.y+this.height&&(t.p.y=this.y+this.height-t.radius,t.v.y*=-1)):this.crossType==="cross"&&(t.p.x+t.radius<this.x&&t.v.x<=0?t.p.x=this.x+this.width+t.radius:t.p.x-t.radius>this.x+this.width&&t.v.x>=0&&(t.p.x=this.x-t.radius),t.p.y+t.radius<this.y&&t.v.y<=0?t.p.y=this.y+this.height+t.radius:t.p.y-t.radius>this.y+this.height&&t.v.y>=0&&(t.p.y=this.y-t.radius))},n}(Q),re=function(r){function n(t,i,a,s){var o;return(o=r.call(this)||this).reset(t,i,a,s),o}c(n,r);var e=n.prototype;return e.reset=function(t,i,a,s){this.imageData=t,this.x=u.initValue(i,0),this.y=u.initValue(a,0),this.d=u.initValue(s,2),this.vectors=[],this.setVectors()},e.setVectors=function(){var t,i,a=this.imageData.width,s=this.imageData.height;for(t=0;t<a;t+=this.d)for(i=0;i<s;i+=this.d){var o=4*((i>>0)*a+(t>>0));this.imageData.data[o+3]>0&&this.vectors.push({x:t+this.x,y:i+this.y})}return this.vector},e.getBound=function(t,i){var a=4*((i>>0)*this.imageData.width+(t>>0));return this.imageData.data[a+3]>0},e.getPosition=function(){var t=u.getRandFromArray(this.vectors);return this.vector.copy(t)},e.getColor=function(t,i){t-=this.x;var a=4*(((i-=this.y)>>0)*this.imageData.width+(t>>0));return{r:this.imageData.data[a],g:this.imageData.data[a+1],b:this.imageData.data[a+2],a:this.imageData.data[a+3]}},e.crossing=function(t){this.crossType==="dead"?this.getBound(t.p.x-this.x,t.p.y-this.y)?t.dead=!0:t.dead=!1:this.crossType==="bound"&&(this.getBound(t.p.x-this.x,t.p.y-this.y)||t.v.negate())},e.destroy=function(){r.prototype.destroy.call(this),this.imageData=null},n}(Q),ne={addEventListener:function(r,n){r.addEventListener("PROTON_UPDATE_AFTER",function(){return n()})},getStyle:function(r){r===void 0&&(r="#ff0000");var n=Y.hexToRgb(r);return"rgba("+n.r+", "+n.g+", "+n.b+", 0.5)"},drawZone:function(r,n,e,t){var i=n.getContext("2d"),a=this.getStyle();this.addEventListener(r,function(){t&&i.clearRect(0,0,n.width,n.height),e instanceof nt?(i.beginPath(),i.fillStyle=a,i.arc(e.x,e.y,10,0,2*Math.PI,!0),i.fill(),i.closePath()):e instanceof xt?(i.beginPath(),i.strokeStyle=a,i.moveTo(e.x1,e.y1),i.lineTo(e.x2,e.y2),i.stroke(),i.closePath()):e instanceof At?(i.beginPath(),i.strokeStyle=a,i.drawRect(e.x,e.y,e.width,e.height),i.stroke(),i.closePath()):e instanceof Et&&(i.beginPath(),i.strokeStyle=a,i.arc(e.x,e.y,e.radius,0,2*Math.PI,!0),i.stroke(),i.closePath())})},drawEmitter:function(r,n,e,t){var i=n.getContext("2d"),a=this.getStyle();this.addEventListener(r,function(){t&&i.clearRect(0,0,n.width,n.height),i.beginPath(),i.fillStyle=a,i.arc(e.p.x,e.p.y,10,0,2*Math.PI,!0),i.fill(),i.closePath()})}};return l.Particle=ot,l.Pool=tt,l.Util=u,l.ColorUtil=Y,l.MathUtil=b,l.Vector2D=l.Vector=w,l.Polar2D=l.Polar=pt,l.ArraySpan=Z,l.Rectangle=ft,l.Rate=gt,l.ease=j,l.Span=m,l.Mat3=z,l.getSpan=function(r,n,e){return new m(r,n,e)},l.createArraySpan=Z.createArraySpan,l.Initialize=l.Init=q,l.Life=l.L=Ct,l.Position=l.P=St,l.Velocity=l.V=Dt,l.Mass=l.M=Mt,l.Radius=l.R=Vt,l.Body=l.B=Bt,l.Behaviour=F,l.Force=l.F=yt,l.Attraction=l.A=mt,l.RandomDrift=l.RD=Lt,l.Gravity=l.G=Ut,l.Collision=Ot,l.CrossZone=Ft,l.Alpha=zt,l.Scale=l.S=kt,l.Rotate=Nt,l.Color=Ht,l.Repulsion=qt,l.Cyclone=Gt,l.GravityWell=Wt,l.Emitter=at,l.BehaviourEmitter=Xt,l.FollowEmitter=Yt,l.Zone=Q,l.LineZone=xt,l.CircleZone=Et,l.PointZone=nt,l.RectZone=At,l.ImageZone=re,l.CanvasRenderer=Zt,l.DomRenderer=Qt,l.EaselRenderer=Kt,l.PixiRenderer=$t,l.PixelRenderer=Jt,l.WebGLRenderer=l.WebGlRenderer=ee,l.CustomRenderer=ie,l.Debug=ne,u.assign(l,j),l})})(It);var fe=It.exports;const S=se(fe),ge={id:"container"},ye=Rt("div",{class:"flex items-center justify-center w-500 h-500"},[Rt("canvas",{id:"testCanvas",class:"w-full h-full"})],-1),me=["src"],ve={__name:"Proton",setup(x){const E=oe(),_=he(()=>E.LATEST_MSG);console.log(_.value);const c=le();let I=null;const v=D=>{I&&cancelAnimationFrame(I);let O,P,M,V,B,d,A,f,g,y,T,u=1,L;$();function $(){P=document.getElementById("testCanvas");let U=P.clientWidth,l=P.clientHeight,p={w:c.value.clientWidth,h:c.value.clientHeight};M=P.getContext("2d"),P.width=U,P.height=l,p.w>P.w&&(p.w=P.w),p.h>P.h&&(p.h=P.h),A=[],f=new S.Rectangle((U-p.w)/2,(l-p.h)/2,p.w,p.h),g=new S.Rectangle(f.x-100,f.y-100,f.width+200,f.height+200),y=new S.RandomDrift(0,0,.05);var m=new S.RectZone(g.x,g.y,g.width,g.height);L=new S.CrossZone(m,"bound"),T=new S.GravityWell({x:U/2,y:l/2},0,0),tt()}function tt(){B=[];var U=[],l=new _t;U[0]=l.addImage(D),l.addCompletionListener(function(){for(var p=0;p<U.length;p++){var m=S.Util.getImageData(M,U[p],f);B.push(new S.ImageZone(m,f.x,f.y)),A.push(m)}st(),b()}),l.start()}function st(){O=new S,d=new S.Emitter,d.rate=new S.Rate(new S.Span(3e4),new S.Span(.1)),d.addInitialize(new S.Mass(1)),d.addInitialize(new S.P(new S.RectZone(g.x,g.y,g.width,g.height))),d.addBehaviour(y),d.addBehaviour(rt(B[0],B[0])),d.addBehaviour(L),d.addBehaviour(T),d.emit("once"),O.addEmitter(d),V=new S.PixelRenderer(P),V.createImageData(g),O.addRenderer(V)}function rt(U,l){return{initialize:function(p){p.R=Math.random()*10,p.Angle=Math.random()*Math.PI*2,p.speed=Math.random()*-2+1,p.zones=[U.getPosition().clone()],p.colors=G(p.zones)},applyBehaviour:function(p){{p.v.clear(),p.Angle+=p.speed;var m=(u%4+1)/2-1,et=p.zones[m].x+p.R*Math.cos(p.Angle),j=p.zones[m].y+p.R*Math.sin(p.Angle);p.p.x+=(et-p.p.x)*.1,p.p.y+=(j-p.p.y)*.1,p.rgb.r=p.colors[m].r,p.rgb.g=p.colors[m].g,p.rgb.b=p.colors[m].b}}}}function G(U){for(var l=[],p=0;p<U.length;p++)l.push(B[p].getColor(U[p].x,U[p].y));return l}function b(){I=requestAnimationFrame(b),O.update()}};return ue(()=>E.LATEST_MSG,D=>{D.img&&Tt(()=>{v(D.img)})}),ce(()=>{Tt(()=>{E.LATEST_MSG&&E.LATEST_MSG.img&&v(E.LATEST_MSG.img)})}),(D,O)=>(Pt(),wt("div",ge,[ye,_.value&&_.value.img?(Pt(),wt("img",{key:0,src:_.value.img,alt:"",ref_key:"$img",ref:c,style:{visibility:"hidden"}},null,8,me)):de("",!0)]))}};export{ve as default};
