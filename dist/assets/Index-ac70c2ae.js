import{U as y,z as M,k as $,o as b,c as S,a as P}from"./vendor-e4930f4d.js";import{s as _}from"./index-25ec05fd.js";class w{constructor(t=0,s=0,i=0,e=1){this.r=t,this.g=s,this.b=i,this.a=e}}class T{constructor(t=0,s=0){this.x=t,this.y=s}}class m{constructor(t=0,s=0,i=0){this.x=t,this.y=s,this.z=i}clone(){return new this.constructor(this.x,this.y,this.z)}}function z(c,t,s){const i=[];for(let l=0;l<s;l++)i.push(`rgb(${Math.floor(Math.random()*255)}, ${Math.floor(Math.random()*255)}, ${Math.floor(Math.random()*255)})`);const e=i.map((l,r)=>`<stop offset="${r/(s-1)*100}%" style="stop-color:${l};stop-opacity:1" />`).join(""),n=20,o=[];for(let l=0;l<c.length;l+=n)o.push(c.substring(l,l+n));typeof t=="string"&&(t=parseFloat(t));const g=t*1.5,a=t*o.reduce((l,r)=>Math.max(l,r.length),0)*.6,d=g*o.length;console.log(a,d,o);const u=`<svg xmlns="http://www.w3.org/2000/svg" width="${a}" height="${d}">
      <defs>
        <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="0%">
          ${e}
        </linearGradient>
      </defs>
      ${o.map((l,r)=>`<text x="50%" y="${g/2+r*g}" font-family="Arial" font-size="${t}px" fill="url(#gradient)" text-anchor="middle" dominant-baseline="central">
          ${l}
        </text>`).join("")}
    </svg>`;return console.log(u),C(u)}function C(c){var t=unescape(encodeURIComponent(c)),s=btoa(t);return"data:image/svg+xml;base64,"+s}function v(c,t){return Math.random()*(t-c)+c}class E{constructor(){this.canvas=void 0,this.context=void 0}createCanvas(t){let s=document.querySelector(t);if(!s)throw new Error("Can not find element"+t);return this.canvas=document.createElement("canvas"),this.canvas.width=s.offsetWidth,this.canvas.height=s.offsetHeight,this.canvas.style.maxWidth="100%",this.canvas.style.maxHeight="100%",this.canvas.style.display="block",s.innerHTML="",s.appendChild(this.canvas),this.context=this.canvas.getContext("2d"),this}getCenter(){return new T(this.canvas.offsetWidth/2,this.canvas.offsetHeight/2)}drawText(t,s,i){const e=z(t,s,3);this.drawImage(e,1e3)}useRecalcSize(t,s){let i=t.height/t.width,e=this.canvas.offsetHeight/this.canvas.offsetWidth;s>this.canvas.offsetWidth&&(s=this.canvas.offsetWidth);let n=s*i;return n>this.canvas.offsetHeight&&(n=this.canvas.offsetHeight),i>e&&(s=n/i),{w:s,h:n}}drawImage(t,s,i={}){return new Promise((e,n)=>{let o=this.context,g=this.getCenter(),a=new Image;a.onload=(function(){s||(s=a.width);let{w:d,h:u}=this.useRecalcSize(a,s);i.x=i.x||g.x-d/2,i.y=i.y||g.y-u/2,o.drawImage(a,0,0,a.width,a.height,i.x,i.y,d,u),e()}).bind(this),a.onerror=()=>{throw new Error("Failed to load image"+t)},a.src=t})}clear(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}getPixels(t=1){let s=[],i=this.context.getImageData(0,0,this.canvas.width,this.canvas.height);for(let e=0;e<i.width;e+=t)for(let n=0;n<i.height;n+=t){let o=(n*i.width+e)*4;i.data[o+3]>128&&s.push({x:e,y:n,color:new w(i.data[o],i.data[o+1],i.data[o+2],i.data[o+3])})}return s}init(t){if(!t)throw new Error(t);return this.createCanvas(t),this}}class A{constructor(t){this.radius=t.radius||1,this.orPos=t.position||new m,this.position=t.position||new m,this.targetPos=t.targetPos||new m,this.color=t.color||new w,this._flag=!0,this._timer=0}animate(t){if(this._flag){this.position.x+=(this.targetPos.x-this.position.x)*.2,this.position.y+=(this.targetPos.y-this.position.y)*.2,this.position.z+=(this.targetPos.z-this.position.z)*.2,Math.abs(this.targetPos.x-this.position.x)<.2&&Math.abs(this.targetPos.y-this.position.y)<.2&&Math.abs(this.targetPos.z-this.position.z)<.2&&(this._flag=!1);return}return t()}draw(t,s){t.save(),t.beginPath(),t.fillStyle=`rgba(${this.color.r},${this.color.g},${this.color.b},1)`,t.fillRect(s.x+(this.position.x-s.x),s.y+(this.position.y-s.y),this.radius,this.radius),t.restore()}}function x(c,t,s=1,i=5){if(!t)return;let e=new E,n=null;e.init(c);let o=0,g=e.getCenter(),a=[];async function d(r){if(n&&cancelAnimationFrame(n),!r)return;a=[],o=0,e.clear(),await e.drawImage(r);let h=e.getPixels(i);e.clear();for(let f=0;f<h.length;f++){let p=new A({radius:s,position:new m(v(0,e.canvas.width),v(0,e.canvas.height),v(-250,250)),targetPos:new m(h[f].x,h[f].y,0),color:new w(h[f].color.r,h[f].color.g,h[f].color.b,h[f].color.a)});a.push(p)}}function u(r){r.save(),r.fillStyle="rgba(0, 0, 0, 0.1)",r.fillRect(0,0,e.canvas.width,e.canvas.height),r.restore();for(let h=0;h<a.length;h++){if(a[h].animate(()=>{o++,o>=a.length&&d()}),a[h]===void 0)return;a[h].draw(r,g)}}async function l(r){h();function h(){n=requestAnimationFrame(h),r(e.context)}}return d(t),l(u),n}const I={class:"flex items-center justify-center"},G=P("div",{id:"image_canvas",class:"w-500 h-500"},null,-1),H=[G],R={__name:"Index",setup(c){const t=_();return y(()=>t.LATEST_MSG),M(()=>t.LATEST_MSG,s=>{console.log(s),s.img&&x("#image_canvas",`${s.img}`,1,5)}),$(()=>{t.LATEST_MSG&&t.LATEST_MSG.img&&x("#image_canvas",`${t.LATEST_MSG.img}`,1,5)}),(s,i)=>(b(),S("div",I,H))}};export{R as default};
